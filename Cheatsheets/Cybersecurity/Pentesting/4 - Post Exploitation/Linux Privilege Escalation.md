Navigation: [[Pentesting]]

---
# Table of Contents
1. Enumeration
2. Environment-based Privesc
3. Permissions-based Privesc
4. Service-based Privesc
5. Linux Internals-based Privesc
# Enumeration
We'll need a lot of information before we can escalate privileges. There are a few helper scripts that exist, but it's also good to know how to do this stuff manually. 

Helper scripts: [`LinPEAS`](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS) and [`LinEnum`](https://github.com/rebootuser/LinEnum).
```shell
# General
whoami # check user
id # check groups
hostname # check computer name
ifconfig # check network info
sudo -l # check sudo perms
history # bash history
find / -type f \( -name *_hist -o -name *_history \) -exec ls -l {} \; 2>/dev/null # history files

# Environment
cat /etc/os-release # os version
echo $PATH # check executable paths
env # env variables
uname -a # kernel version
lscpu # cpu info
cat /etc/shells # check existing shells
lpstat # printers
ls -la /etc/cron.daily/ # cron jobs
find /proc -name cmdline -exec cat {} \; 2>/dev/null | tr " " "\n" # system processes info
sudo -V # sudo version
find / -type f \( -name *.conf -o -name *.config \) -exec ls -l {} \; 2>/dev/null # configuration files

# Appplications
apt list --installed | tr "/" " " | cut -d" " -f1,3 | sed 's/[0-9]://g' | tee -a installed_pkgs.list # installed packages
ls -l /bin /usr/bin/ /usr/sbin/ # binaries
find / -type f -name "*.sh" 2>/dev/null | grep -v "src\|snap\|share" # scripts
ps aux | grep <user> # services by user

# Users
cat /etc/passwd # list all users
grep "*sh$" /etc/passwd # find which users have login shells
cat /etc/group # list all groups
getent group sudo # list users who can sudo
ls /home # check users with a home directory
lastlog # check last login from users
w # logged in users

# Files
cat /etc/fstab # mounted and unmounted drives
lsblk # check block devices
df -h # check mounted file systems
cat /etc/fstab | grep -v "#" | column -t # unmounted file systems (as root we can mount then read)

# Hidden files/directories
find / -type f -name ".*" -exec ls -l {} \; 2>/dev/null | grep <user>
find / -type d -name ".*" -ls 2>/dev/null

# Temporary files
ls -l /tmp /var/tmp /dev/shm

# Network information
ip a
cat /etc/hosts
route # ip routing table
cat /etc/resolv.conf # for domain env, check internal DNS
arp -a # check arp table

# Credentials
ls ~/.ssh # ssh keys
# also check any conf files

# GTFObins
for i in $(curl -s https://gtfobins.github.io/ | html2text | cut -d" " -f1 | sed '/^[[:space:]]*$/d');do if grep -q "$i" installed_pkgs.list;then echo "Check GTFO for: $i";fi;done
```

Common defenses to look for:
- [`Exec Shield`](https://en.wikipedia.org/wiki/Exec_Shield)
- [`iptables`](https://linux.die.net/man/8/iptables)
- [`AppArmor`](https://apparmor.net/)
- [`SELinux`](https://www.redhat.com/en/topics/linux/what-is-selinux)
- [`Fail2ban`](https://github.com/fail2ban/fail2ban)
- [`Snort`](https://www.snort.org/faq/what-is-snort)
- [`Uncomplicated Firewall (ufw)`](https://wiki.ubuntu.com/UncomplicatedFirewall)

---
Navigation: [[Pentesting]]