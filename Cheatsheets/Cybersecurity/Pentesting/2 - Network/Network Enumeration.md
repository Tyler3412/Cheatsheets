Navigation: [[Pentesting]]

---
# Introduction
This just serves as a really quick reference sheet to nmap commands. Here's a list of the scan types we'll be looking at:
1. Output and Performance
2. Host discovery
3. Service and OS enumeration
4. Nmap scripting engine
5. Avoiding detection

Here's the general syntax of an nmap scan:
```shell
nmap <scan types> <options> <target>
```

The current syntax can be found here:
https://svn.nmap.org/nmap/docs/nmap.usage.txt

Alternatively, a faster scanner known as [masscan](https://github.com/robertdavidgraham/masscan) exists, although it lacks the scripting capabilities of nmap. The difference is that masscan is tuned towards scanning a large amount of machines, whereas nmap is better for intensively scanning a few machines. I'll be including a section dedicated to masscan at the end.
# Scanning With Nmap
### Output and Performance
To save output, we have the following options:
- `-oN <output>`  : output is .nmap file extension
- `-oG <output>` : greppable nmap file extension
- `-oX <output>` : XML output
- `-oA <output>` : all of the above

To change our performance, we can use:
- `-T <0-5>` for speed. The higher the number, the faster and more aggressive scanning is
- `--min-parallelism <number>` for frequency
- `--max-rtt-timeout <time>` for max timeout time
- `--max-retries <number>` for maximum number of retries for scanned ports

### Host Scanning
Here's a quick way to scan for hosts on nmap:
```shell
sudo nmap 10.129.2.0/24 -sn
```

\*\* Note that `-sn` automatically enables ping scan with ICMP echo requests (`-PE`). However, nmap also sends an ARP ping resulting in an ARP reply before the ICMP request. To ensure ICMP requests are sent, we can use the `-PE` option

Nmap tends to have issues checking if hosts are up, refer to the masscan section at the end
### Service and OS Enumeration
First, here's a way that we can scan a list of hosts (the hosts file should be a single IP followed by a newline):
```shell
sudo nmap -iL hosts.lst
```

Here's a quick scan that I like to use for single hosts:
```shell
sudo nmap -T4 -p- -O -sV -vv -sC 10.0.0.1 -oN scan.out
```

This scan will scan all TCP ports, reporting service and OS version.

If we wanted to scan UDP, we can use something like:
```shell
sudo nmap -sU -T4 -O -sV -vv -sC 10.0.0.1 -oN scan.out
```

Note that scanning all ports was removed here. This was done purposely, UDP scans tend to be very slow in comparison to TCP scans.

Lastly, we can further enumerate a service without nmap. In this case, we'll need tcpdump and netcat. This helps us to grab any banner information that wasn't caught by nmap:
```shell-session
sudo tcpdump -i eth0 host 10.10.14.2 and 10.129.2.28
```

```shell-session
nc -nv 10.129.2.28 25
```
### Nmap Scripting Engine
NSE is a feature that allows us to use Lua scripts for deeper enumeration. A list of prewritten scripts is also [provided by nmap.org](https://nmap.org/nsedoc/scripts/). These are very useful, take advantage of them.

**Running with Default Scripts**
```shell-session
sudo nmap <target> -sC
```

**Running a Category of Scripts**
```shell-session
sudo nmap <target> --script <category>
```

**Picking Defined Scripts**
```shell-session
sudo nmap <target> --script <script-name>,<script-name>,...
```
### Avoiding Detection
Nmap provides a few options for evasion. Check out the syntax link above, the section is towards the bottom of that.
# Masscan
Lastly, we have masscan. Here's a quick use command:
```shell
masscan -p80,8000-8100 10.0.0.0/8
```

If we want to grab banners, we can use:
```shell
masscan 10.0.0.0/8 -p80 --banners --source-ip 192.168.1.200
```

Note that we need a separate IP that's on the subnet. Masscan uses its own TCP/IP stack, making this a necessity.

---
Navigation: [[Pentesting]]